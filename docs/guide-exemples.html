<!DOCTYPE html>
<html lang="fr" data-fr-theme>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemples d'implementations - Guide - gouv-widgets</title>
  <style>@view-transition{navigation:auto}app-header:not(:defined){display:block;min-height:56px}app-footer:not(:defined){display:block;min-height:48px}</style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css">
  <script type="module" src="/dist/gouv-widgets.esm.js"></script>
  <style>
    .guide-layout { display: flex; gap: 2rem; }
    .guide-sidemenu { flex: 0 0 280px; position: sticky; top: 1rem; height: fit-content; max-height: calc(100vh - 2rem); overflow-y: auto; }
    .guide-content { flex: 1; min-width: 0; }
    @media (max-width: 992px) {
      .guide-layout { flex-direction: column; }
      .guide-sidemenu { position: static; flex: none; max-height: none; }
    }
    .guide-content h2 { padding-top: 2rem; border-top: 1px solid var(--border-default-grey); margin-top: 3rem; }
    .guide-content h2:first-of-type { border-top: none; margin-top: 0; padding-top: 0; }
    .guide-content h3 { margin-top: 2rem; }
    .guide-content h4 { margin-top: 1.5rem; }
    .guide-content pre { background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 4px; font-family: monospace; font-size: 0.85rem; overflow-x: auto; white-space: pre-wrap; margin: 0; }
    .guide-content ol, .guide-content ul { margin: 0.5rem 0 1rem 1.5rem; }
    .guide-content li { margin-bottom: 0.25rem; }
    .fr-sidemenu__link[aria-current="true"] { font-weight: 700; color: var(--text-action-high-blue-france); }
    .example-iframe { width: 100%; border: 1px solid var(--border-default-grey); border-radius: 4px; min-height: 300px; overflow: hidden; background: white; }
    .example-loading { padding: 2rem; text-align: center; color: var(--text-mention-grey); border: 1px solid var(--border-default-grey); border-radius: 4px; }
  </style>
</head>
<body>
  <app-header current-page="guide" base-path="../"></app-header>

  <main class="fr-container fr-py-4w" id="main-content">
    <div class="guide-layout">

      <!-- Sidemenu -->
      <nav class="fr-sidemenu guide-sidemenu" role="navigation" aria-labelledby="guide-sidemenu-title">
        <div class="fr-sidemenu__inner">
          <button class="fr-sidemenu__btn" hidden aria-controls="guide-sidemenu-wrapper" aria-expanded="true">Menu</button>
          <div class="fr-collapse" id="guide-sidemenu-wrapper">
            <div class="fr-sidemenu__title" id="guide-sidemenu-title">Guide utilisateur</div>
            <ul class="fr-sidemenu__list">
              <li class="fr-sidemenu__item">
                <a class="fr-sidemenu__link" href="guide.html#overview">Vue d'ensemble</a>
              </li>
              <li class="fr-sidemenu__item">
                <a class="fr-sidemenu__link" href="guide-parcours.html">Parcours utilisateur</a>
              </li>
              <li class="fr-sidemenu__item">
                <button class="fr-sidemenu__btn" aria-expanded="true" aria-controls="guide-exemples">
                  Exemples d'implementations
                </button>
                <div class="fr-collapse fr-collapse--expanded" id="guide-exemples">
                  <ul class="fr-sidemenu__list">
                    <li class="fr-sidemenu__item"><a class="fr-sidemenu__link" href="#exemples-direct" data-guide-link>Mode direct</a></li>
                    <li class="fr-sidemenu__item"><a class="fr-sidemenu__link" href="#exemples-normalize" data-guide-link>Avec normalisation</a></li>
                    <li class="fr-sidemenu__item"><a class="fr-sidemenu__link" href="#exemples-query" data-guide-link>Avec requete</a></li>
                    <li class="fr-sidemenu__item"><a class="fr-sidemenu__link" href="#exemples-search" data-guide-link>Avec recherche</a></li>
                    <li class="fr-sidemenu__item"><a class="fr-sidemenu__link" href="#exemples-display" data-guide-link>Affichage dynamique</a></li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Contenu principal -->
      <div class="guide-content">

        <h1><i class="ri-code-box-line fr-mr-1w"></i>Exemples d'implementations</h1>
        <p class="fr-text--lead">
          Exemples prets a l'emploi, organises par mode de construction.
          Chaque exemple affiche le rendu live avec le code source en accordeon.
        </p>
        <p>Trois sources de donnees publiques sont utilisees en alternance :</p>
        <ul>
          <li><strong>Fiscalite locale</strong> — Taux de taxes foncieres et d'habitation par commune (data.economie.gouv.fr)</li>
          <li><strong>Elus municipaux</strong> — Repertoire national des elus (tabular-api.data.gouv.fr)</li>
          <li><strong>Industrie du futur</strong> — Beneficiaires et investissements par region (data.economie.gouv.fr)</li>
        </ul>

        <!-- ============================================================
             MODE DIRECT
             ============================================================ -->
        <section id="exemples-direct">
          <h2>Mode direct : gouv-source &rarr; composant</h2>
          <p>Les donnees de la source sont transmises directement au composant de visualisation, sans transformation intermediaire.</p>

          <!-- direct-bar -->
          <h4>Barres — Taux de taxe fonciere par commune</h4>
          <p>Graphique en barres affichant les taux de taxe fonciere de 15 communes.
            <a href="../apps/playground/index.html?example=direct-bar" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-bar">Code source</button></h3>
            <div class="fr-collapse" id="code-d-bar">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=15"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="bar"
  label-field="libcom" value-field="taux_global_tfb"
  unit-tooltip="%" selected-palette="categorical"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-line -->
          <h4>Courbe — Beneficiaires Industrie du futur</h4>
          <p>Courbe du nombre de beneficiaires par departement.
            <a href="../apps/playground/index.html?example=direct-line" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-line">Code source</button></h3>
            <div class="fr-collapse" id="code-d-line">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=20"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="line"
  label-field="nom_departement" value-field="nombre_beneficiaires"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-pie -->
          <h4>Camembert — Poids demographique</h4>
          <p>Diagramme circulaire du poids demographique par commune.
            <a href="../apps/playground/index.html?example=direct-pie" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-pie">Code source</button></h3>
            <div class="fr-collapse" id="code-d-pie">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=8"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="pie"
  label-field="libcom" value-field="mpoid"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-radar -->
          <h4>Radar — Beneficiaires par region</h4>
          <p>Graphique radar montrant le profil des beneficiaires.
            <a href="../apps/playground/index.html?example=direct-radar" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-radar">Code source</button></h3>
            <div class="fr-collapse" id="code-d-radar">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=6"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="radar"
  label-field="nom_region" value-field="nombre_beneficiaires"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-gauge -->
          <h4>Jauge — Taux de taxe fonciere</h4>
          <p>Jauge affichant le taux de taxe fonciere d'une commune (1 enregistrement).
            <a href="../apps/playground/index.html?example=direct-gauge" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-gauge">Code source</button></h3>
            <div class="fr-collapse" id="code-d-gauge">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=1"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="gauge"
  value-field="taux_global_tfb"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-scatter -->
          <h4>Nuage — Investissement vs participation</h4>
          <p>Nuage de points croisant investissement et participation de l'Etat.
            <a href="../apps/playground/index.html?example=direct-scatter" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-scatter">Code source</button></h3>
            <div class="fr-collapse" id="code-d-scatter">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="scatter"
  label-field="montant_investissement"
  value-field="montant_participation_etat"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-barline -->
          <h4>Barres + ligne — Investissements</h4>
          <p>Combine barres (investissement) et ligne (participation Etat) via <code>value-field-2</code>.
            <a href="../apps/playground/index.html?example=direct-barline" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-barline">Code source</button></h3>
            <div class="fr-collapse" id="code-d-barline">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=15"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="bar-line"
  label-field="nom_departement"
  value-field="montant_investissement"
  value-field-2="montant_participation_etat"
  name='["Investissement", "Participation Etat"]'&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-map -->
          <h4>Carte — Beneficiaires par departement</h4>
          <p>Carte de France coloree par nombre de beneficiaires, via <code>code-field</code>.
            <a href="../apps/playground/index.html?example=direct-map" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-map">Code source</button></h3>
            <div class="fr-collapse" id="code-d-map">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-dsfr-chart source="data" type="map"
  code-field="code_departement" value-field="nombre_beneficiaires"
  selected-palette="sequentialAscending"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- direct-kpi -->
          <h4>KPI — Indicateurs Industrie du futur</h4>
          <p>Quatre indicateurs cles calcules directement depuis les donnees brutes.
            <a href="../apps/playground/index.html?example=direct-kpi" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-kpi">Code source</button></h3>
            <div class="fr-collapse" id="code-d-kpi">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;"&gt;
  &lt;gouv-kpi source="data" valeur="sum:nombre_beneficiaires"
    label="Total beneficiaires" format="nombre"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="data" valeur="avg:nombre_beneficiaires"
    label="Moyenne" format="decimal"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="data" valeur="max:montant_investissement"
    label="Investissement max" format="euro" couleur="vert"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="data" valeur="count"
    label="Enregistrements" format="nombre"&gt;&lt;/gouv-kpi&gt;
&lt;/div&gt;</pre>
            </div>
          </section>

          <!-- direct-datalist -->
          <h4>Tableau — Registre des elus</h4>
          <p>Tableau interactif avec recherche, filtres, tri et export CSV.
            <a href="../apps/playground/index.html?example=direct-datalist" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-d-datalist">Code source</button></h3>
            <div class="fr-collapse" id="code-d-datalist">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=50"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-datalist source="data"
  colonnes="Nom de l'elu:Nom, Prenom de l'elu:Prenom, Libelle de la fonction:Fonction"
  recherche="true" filtres="Libelle du  departement"
  tri="Nom de l'elu:asc" pagination="10" export="csv"&gt;
&lt;/gouv-datalist&gt;</pre>
            </div>
          </section>
        </section>

        <!-- ============================================================
             AVEC NORMALISATION
             ============================================================ -->
        <section id="exemples-normalize">
          <h3>Avec normalisation : gouv-source &rarr; gouv-normalize &rarr; composant</h3>
          <p>Les donnees passent par <code>gouv-normalize</code> qui nettoie les valeurs (conversion numerique, renommage, trim) avant de les transmettre au composant de visualisation ou a <code>gouv-query</code>.</p>

          <!-- normalize-numeric -->
          <h4>Barres — Conversion numerique + renommage</h4>
          <p>Les donnees brutes contiennent des populations en string et des cles d'API peu lisibles. <code>gouv-normalize</code> convertit les nombres et renomme les colonnes avant l'agregation.</p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-n-bar">Code source</button></h3>
            <div class="fr-collapse" id="code-n-bar">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="data"
  numeric="nombre_beneficiaires, montant_investissement"
  rename="nom_region:Region | nombre_beneficiaires:Beneficiaires | montant_investissement:Investissement"
  trim&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-query id="stats" source="clean"
  group-by="Region"
  aggregate="Beneficiaires:sum"
  order-by="Beneficiaires__sum:desc"
  limit="10"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="stats" type="bar"
  label-field="Region" value-field="Beneficiaires__sum"
  selected-palette="categorical"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- normalize-clean -->
          <h4>Tableau — Nettoyage complet des donnees</h4>
          <p>Nettoyage multi-etapes : trim des espaces, detection automatique des nombres, et remplacement des valeurs vides avant affichage dans un tableau interactif.</p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-n-datalist">Code source</button></h3>
            <div class="fr-collapse" id="code-n-datalist">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/d0566522-604d-4571-848c-73c73c254230/data/?page_size=50"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="data"
  trim
  numeric-auto
  replace="N/A: | n.d.: | -:"&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-datalist source="clean"
  recherche pagination="10" export="csv"&gt;
&lt;/gouv-datalist&gt;</pre>
            </div>
          </section>
        </section>

        <!-- ============================================================
             AVEC REQUETE
             ============================================================ -->
        <section id="exemples-query">
          <h2>Avec requete : gouv-source &rarr; gouv-query &rarr; composant</h2>
          <p>Les donnees passent par <code>gouv-query</code> qui les filtre, regroupe et/ou agrege avant de les transmettre au composant de visualisation.</p>

          <!-- query-bar -->
          <h4>Barres — Beneficiaires agreges par region</h4>
          <p>Regroupe par region et somme les beneficiaires avec <code>group-by</code> + <code>aggregate</code>.
            <a href="../apps/playground/index.html?example=query-bar" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-bar">Code source</button></h3>
            <div class="fr-collapse" id="code-q-bar">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="nom_region"
  aggregate="nombre_beneficiaires:sum:beneficiaires"
  order-by="beneficiaires:desc" limit="10"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="bar"
  label-field="nom_region" value-field="beneficiaires"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-line -->
          <h4>Courbe — Taux moyen TFB par region</h4>
          <p>Calcule la moyenne du taux de taxe fonciere par region.
            <a href="../apps/playground/index.html?example=query-line" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-line">Code source</button></h3>
            <div class="fr-collapse" id="code-q-line">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="libreg"
  aggregate="taux_global_tfb:avg:taux_moyen"
  order-by="taux_moyen:desc"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="line"
  label-field="libreg" value-field="taux_moyen" unit-tooltip="%"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-pie -->
          <h4>Camembert — Elus par categorie socio-pro</h4>
          <p>Compte les elus par categorie socio-professionnelle via <code>count</code>.
            <a href="../apps/playground/index.html?example=query-pie" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-pie">Code source</button></h3>
            <div class="fr-collapse" id="code-q-pie">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="Libelle de la categorie socio-professionnelle"
  aggregate="Code sexe:count:nombre"
  order-by="nombre:desc" limit="8"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="pie"
  label-field="Libelle de la categorie socio-professionnelle"
  value-field="nombre"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-radar -->
          <h4>Radar — Investissement moyen par region</h4>
          <p>Calcule l'investissement moyen par region (limite a 6 pour lisibilite).
            <a href="../apps/playground/index.html?example=query-radar" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-radar">Code source</button></h3>
            <div class="fr-collapse" id="code-q-radar">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="nom_region"
  aggregate="montant_investissement:avg:investissement"
  limit="6"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="radar"
  label-field="nom_region" value-field="investissement"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-gauge -->
          <h4>Jauge — Taux moyen TFB regional</h4>
          <p>Calcule la moyenne par region, trie par taux decroissant et prend le premier (limit=1).
            <a href="../apps/playground/index.html?example=query-gauge" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-gauge">Code source</button></h3>
            <div class="fr-collapse" id="code-q-gauge">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="libreg"
  aggregate="taux_global_tfb:avg:taux_moyen"
  order-by="taux_moyen:desc" limit="1"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="gauge"
  value-field="taux_moyen"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-scatter -->
          <h4>Nuage — TFB vs TH par departement</h4>
          <p>Double agregation : moyenne TFB (axe X) et TH (axe Y) par departement.
            <a href="../apps/playground/index.html?example=query-scatter" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-scatter">Code source</button></h3>
            <div class="fr-collapse" id="code-q-scatter">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="libdep"
  aggregate="taux_global_tfb:avg:tfb, taux_global_th:avg:th"
  limit="30"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="scatter"
  label-field="tfb" value-field="th"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-barline -->
          <h4>Barres + ligne — TFB et TH par region</h4>
          <p>Barres pour le TFB moyen et ligne pour le TH moyen, combines via <code>value-field-2</code>.
            <a href="../apps/playground/index.html?example=query-barline" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-barline">Code source</button></h3>
            <div class="fr-collapse" id="code-q-barline">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="libreg"
  aggregate="taux_global_tfb:avg:tfb, taux_global_th:avg:th"
  order-by="tfb:desc"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="bar-line"
  label-field="libreg" value-field="tfb" value-field-2="th"
  name='["Taxe fonciere (TFB)", "Taxe habitation (TH)"]'
  unit-tooltip="%"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-map -->
          <h4>Carte — Taux TFB par departement</h4>
          <p>Moyenne du taux TFB par code departement, affichee sur la carte de France.
            <a href="../apps/playground/index.html?example=query-map" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-map">Code source</button></h3>
            <div class="fr-collapse" id="code-q-map">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/fiscalite-locale-des-particuliers/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  group-by="dep"
  aggregate="taux_global_tfb:avg:taux"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="q" type="map"
  code-field="dep" value-field="taux"
  selected-palette="sequentialAscending"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>

          <!-- query-kpi -->
          <h4>KPI — Statistiques des elus avec filtre</h4>
          <p>Filtre les Maires et compare le sous-ensemble au total via deux KPI distincts.
            <a href="../apps/playground/index.html?example=query-kpi" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-kpi">Code source</button></h3>
            <div class="fr-collapse" id="code-q-kpi">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q-maires" source="data"
  filter="Libelle de la fonction:contains:Maire"&gt;
&lt;/gouv-query&gt;

&lt;div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;"&gt;
  &lt;gouv-kpi source="data" valeur="count"
    label="Total des elus" format="nombre"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="q-maires" valeur="count"
    label="Dont Maires" format="nombre" couleur="bleu"&gt;&lt;/gouv-kpi&gt;
&lt;/div&gt;</pre>
            </div>
          </section>

          <!-- query-datalist -->
          <h4>Tableau — Elus filtres par region</h4>
          <p>Filtre les elus d'Ile-de-France et affiche le resultat dans un tableau interactif.
            <a href="../apps/playground/index.html?example=query-datalist" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-q-datalist">Code source</button></h3>
            <div class="fr-collapse" id="code-q-datalist">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="q" source="data"
  filter="Libelle de la region:contains:Ile"&gt;
&lt;/gouv-query&gt;

&lt;gouv-datalist source="q"
  colonnes="Nom de l'elu:Nom, Prenom de l'elu:Prenom, Libelle de la fonction:Fonction"
  recherche="true" tri="Nom de l'elu:asc" pagination="10" export="csv"&gt;
&lt;/gouv-datalist&gt;</pre>
            </div>
          </section>
        </section>

        <!-- ============================================================
             AVEC RECHERCHE
             ============================================================ -->
        <section id="exemples-search">
          <h2>Avec recherche : gouv-source &rarr; gouv-search &rarr; composant</h2>
          <p><code>gouv-search</code> affiche un champ de recherche DSFR et filtre les donnees en amont avant de les redistribuer aux composants en aval. Il se combine naturellement avec <code>gouv-facets</code> et <code>gouv-display</code>.</p>

          <!-- search-datalist -->
          <h4>Tableau — Recherche textuelle sur les elus</h4>
          <p>Recherche sur les champs Nom, Prenom et Fonction avec l'operateur <code>words</code> (tous les mots saisis doivent etre presents). Le tableau se filtre en temps reel avec un compteur de resultats.
            <a href="../apps/playground/index.html?example=search-datalist" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-s-datalist">Code source</button></h3>
            <div class="fr-collapse" id="code-s-datalist">
<pre class="example-code">&lt;gouv-source id="raw"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="raw"
  rename="Nom de l'elu:Nom | Prenom de l'elu:Prenom | Libelle de la fonction:Fonction | Libelle du  departement:Departement | Libelle de la categorie socio-professionnelle:Categorie"
  trim&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-search id="searched" source="clean"
  fields="Nom, Prenom, Fonction"
  placeholder="Nom, prenom ou fonction..."
  operator="words"
  min-length="2"
  count&gt;
&lt;/gouv-search&gt;

&lt;gouv-datalist source="searched"
  colonnes="Nom, Prenom, Fonction, Departement, Categorie"
  tri="Nom:asc" pagination="10"&gt;
&lt;/gouv-datalist&gt;</pre>
            </div>
          </section>

          <!-- search-display -->
          <h4>Cartes — Recherche sur Industrie du futur</h4>
          <p>Recherche textuelle combinee avec <code>gouv-display</code> pour afficher les resultats sous forme de cartes DSFR.
            <a href="../apps/playground/index.html?example=search-display" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-s-display">Code source</button></h3>
            <div class="fr-collapse" id="code-s-display">
<pre class="example-code">&lt;gouv-source id="raw"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="raw"
  numeric="montant_investissement, nombre_beneficiaires"
  rename="nom_region:Region | nom_departement:Departement | nom_entreprise:Entreprise"
  trim&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-search id="searched" source="clean"
  fields="Entreprise, Region, Departement"
  placeholder="Entreprise, region ou departement..."
  operator="words" count&gt;
&lt;/gouv-search&gt;

&lt;gouv-display source="searched" cols="3" pagination="9"&gt;
  &lt;template&gt;
    &lt;div class="fr-card"&gt;
      &lt;div class="fr-card__body"&gt;
        &lt;div class="fr-card__content"&gt;
          &lt;h3 class="fr-card__title"&gt;{{Entreprise}}&lt;/h3&gt;
          &lt;p class="fr-card__desc"&gt;{{Departement}} — {{Region}}&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class="fr-card__footer"&gt;
          &lt;p class="fr-badge fr-badge--sm"&gt;{{montant_investissement}} EUR&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/gouv-display&gt;</pre>
            </div>
          </section>

          <!-- search-facets-display -->
          <h4>Recherche + facettes + cartes</h4>
          <p>Pipeline complet : la recherche reduit le jeu de donnees, les facettes affinent, et <code>gouv-display</code> genere les cartes. Les compteurs de facettes se recalculent dynamiquement.
            <a href="../apps/playground/index.html?example=search-facets-display" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-s-facets">Code source</button></h3>
            <div class="fr-collapse" id="code-s-facets">
<pre class="example-code">&lt;gouv-source id="raw"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="raw"
  rename="Nom de l'elu:Nom | Prenom de l'elu:Prenom | Libelle de la fonction:Fonction | Libelle du  departement:Departement"
  trim&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-search id="searched" source="clean"
  fields="Nom, Prenom, Departement, Fonction"
  placeholder="Rechercher un elu..."
  operator="words" count&gt;
&lt;/gouv-search&gt;

&lt;gouv-facets id="filtered" source="searched"
  fields="Fonction, Departement"
  labels="Fonction:Fonction | Departement:Departement"
  max-values="6"&gt;
&lt;/gouv-facets&gt;

&lt;gouv-display source="filtered" cols="3" pagination="9"&gt;
  &lt;template&gt;
    &lt;div class="fr-card"&gt;
      &lt;div class="fr-card__body"&gt;
        &lt;div class="fr-card__content"&gt;
          &lt;h3 class="fr-card__title"&gt;{{Prenom}} {{Nom}}&lt;/h3&gt;
          &lt;p class="fr-card__desc"&gt;{{Fonction}}&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class="fr-card__footer"&gt;
          &lt;p class="fr-badge fr-badge--sm"&gt;{{Departement}}&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/gouv-display&gt;</pre>
            </div>
          </section>

          <!-- search-kpi-chart -->
          <h4>Recherche + KPI + graphique</h4>
          <p>Les KPI et le graphique se recalculent en temps reel selon le terme de recherche.
            <a href="../apps/playground/index.html?example=search-kpi-chart" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-s-kpi">Code source</button></h3>
            <div class="fr-collapse" id="code-s-kpi">
<pre class="example-code">&lt;gouv-source id="raw"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=100"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="raw"
  numeric="montant_investissement, nombre_beneficiaires"
  rename="nom_region:Region | nom_departement:Departement | nom_entreprise:Entreprise"
  trim&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-search id="searched" source="clean"
  fields="Entreprise, Region, Departement"
  placeholder="Entreprise, region, departement..."
  operator="words" count&gt;
&lt;/gouv-search&gt;

&lt;div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;"&gt;
  &lt;gouv-kpi source="searched" valeur="count"
    label="Projets" couleur="bleu"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="searched" valeur="sum:montant_investissement"
    label="Investissement total" format="euro"&gt;&lt;/gouv-kpi&gt;
  &lt;gouv-kpi source="searched" valeur="sum:nombre_beneficiaires"
    label="Beneficiaires" format="nombre"&gt;&lt;/gouv-kpi&gt;
&lt;/div&gt;

&lt;gouv-query id="stats" source="searched"
  group-by="Region"
  aggregate="nombre_beneficiaires:sum:Beneficiaires"
  order-by="Beneficiaires:desc" limit="10"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart source="stats" type="bar"
  label-field="Region" value-field="Beneficiaires"
  selected-palette="categorical"&gt;
&lt;/gouv-dsfr-chart&gt;</pre>
            </div>
          </section>
        </section>

        <!-- ============================================================
             AFFICHAGE DYNAMIQUE
             ============================================================ -->
        <section id="exemples-display">
          <h2>Affichage dynamique : gouv-source &rarr; gouv-display</h2>
          <p><code>gouv-display</code> repete un template HTML pour chaque element de donnees. Ideal pour creer des cartes DSFR, tuiles, ou tout motif repetitif. Syntaxe : <code>{{champ}}</code> (echappe), <code>{{{champ}}}</code> (brut), <code>{{champ|defaut}}</code> (fallback), <code>{{$index}}</code> (index).</p>

          <!-- direct-display -->
          <h4>Cartes — Industrie du futur</h4>
          <p>Grille de cartes DSFR generees dynamiquement via template, avec pagination.
            <a href="../apps/playground/index.html?example=direct-display" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-disp-cards">Code source</button></h3>
            <div class="fr-collapse" id="code-disp-cards">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/industrie-du-futur/records?limit=12"
  transform="results"&gt;&lt;/gouv-source&gt;

&lt;gouv-display source="data" cols="3" pagination="6"&gt;
  &lt;template&gt;
    &lt;div class="fr-card"&gt;
      &lt;div class="fr-card__body"&gt;
        &lt;div class="fr-card__content"&gt;
          &lt;h3 class="fr-card__title"&gt;{{nom_departement}}&lt;/h3&gt;
          &lt;p class="fr-card__desc"&gt;
            Region : {{nom_region}}&lt;br&gt;
            Beneficiaires : {{nombre_beneficiaires}}
          &lt;/p&gt;
        &lt;/div&gt;
        &lt;div class="fr-card__footer"&gt;
          &lt;p class="fr-badge fr-badge--sm"&gt;{{montant_investissement}} EUR&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/gouv-display&gt;</pre>
            </div>
          </section>

          <!-- query-display -->
          <h4>Cartes — Elus filtres par fonction</h4>
          <p>Combine un filtre <code>gouv-query</code> (uniquement les Maires) avec un affichage en cartes.
            <a href="../apps/playground/index.html?example=query-display" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-disp-query">Code source</button></h3>
            <div class="fr-collapse" id="code-disp-query">
<pre class="example-code">&lt;gouv-source id="data"
  url="https://tabular-api.data.gouv.fr/api/resources/a595be27-cfab-4810-b9d4-22e193bffe35/data/?page_size=100"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-query id="maires" source="data"
  filter="Libelle de la fonction:eq:Maire"&gt;
&lt;/gouv-query&gt;

&lt;gouv-display source="maires" cols="4" pagination="8"&gt;
  &lt;template&gt;
    &lt;div class="fr-card fr-card--shadow"&gt;
      &lt;div class="fr-card__body"&gt;
        &lt;div class="fr-card__content"&gt;
          &lt;h3 class="fr-card__title"&gt;{{Nom de l'elu}} {{Prenom de l'elu}}&lt;/h3&gt;
          &lt;p class="fr-card__desc"&gt;{{Libelle de la fonction}}&lt;/p&gt;
          &lt;div class="fr-card__start"&gt;
            &lt;p class="fr-badge fr-badge--sm fr-badge--green-emeraude"&gt;{{Libelle du  departement}}&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/gouv-display&gt;</pre>
            </div>
          </section>

          <!-- normalize-display -->
          <h4>Tuiles — LOVAC logements vacants</h4>
          <p>Donnees LOVAC nettoyees par <code>gouv-normalize</code> puis affichees sous forme de tuiles DSFR.
            <a href="../apps/playground/index.html?example=normalize-display" class="fr-link fr-link--sm">Tester dans le Playground</a>
          </p>
          <div class="example-loading" data-example>Chargement...</div>
          <section class="fr-accordion fr-mt-1w">
            <h3 class="fr-accordion__title"><button class="fr-accordion__btn" aria-expanded="false" aria-controls="code-disp-tiles">Code source</button></h3>
            <div class="fr-collapse" id="code-disp-tiles">
<pre class="example-code">&lt;gouv-source id="raw"
  url="https://tabular-api.data.gouv.fr/api/resources/42a34c0a-7c97-4463-b00e-5913ea5f7077/data/?page_size=101"
  transform="data"&gt;&lt;/gouv-source&gt;

&lt;gouv-normalize id="clean" source="raw"
  trim numeric-auto
  rename="LIB_DEP:Departement | pp_vacant_25:Vacants | pp_total_24:Total logements | DEP:Code"&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-query id="top" source="clean"
  order-by="Vacants:desc" limit="9"&gt;
&lt;/gouv-query&gt;

&lt;gouv-display source="top" cols="3"&gt;
  &lt;template&gt;
    &lt;div class="fr-tile"&gt;
      &lt;div class="fr-tile__body"&gt;
        &lt;div class="fr-tile__content"&gt;
          &lt;h3 class="fr-tile__title"&gt;{{Departement}}&lt;/h3&gt;
          &lt;p class="fr-tile__detail"&gt;Dept. {{Code}}&lt;/p&gt;
          &lt;p class="fr-tile__desc"&gt;
            {{Vacants}} logements vacants sur {{Total logements}} au total
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/gouv-display&gt;</pre>
            </div>
          </section>
        </section>

      </div><!-- /guide-content -->
    </div><!-- /guide-layout -->
  </main>

  <app-footer base-path="../"></app-footer>

  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.module.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- Iframe generation from code blocks ---
      const iframeTemplate = (code) => `<!DOCTYPE html>
<html lang="fr" data-fr-theme>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.css">
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.js"><\/script>
  <script type="module" src="/dist/gouv-widgets.esm.js"><\/script>
  <style>body { margin: 0; padding: 1rem; font-family: Marianne, arial, sans-serif; }</style>
</head>
<body>
  ${code}
  <script>
    new ResizeObserver(() => {
      window.parent.postMessage({ type: 'iframe-resize', h: document.body.scrollHeight }, '*');
    }).observe(document.body);
  <\/script>
</body>
</html>`;

      // Find the code block associated with each example placeholder
      function getCodeForExample(placeholder) {
        const accordion = placeholder.nextElementSibling;
        if (!accordion) return null;
        const pre = accordion.querySelector('.example-code');
        return pre ? pre.textContent : null;
      }

      // Lazy-load iframes via IntersectionObserver
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) return;
          const placeholder = entry.target;
          observer.unobserve(placeholder);
          const code = getCodeForExample(placeholder);
          if (!code) return;
          const iframe = document.createElement('iframe');
          iframe.className = 'example-iframe';
          iframe.srcdoc = iframeTemplate(code);
          iframe.loading = 'lazy';
          placeholder.replaceWith(iframe);
        });
      }, { rootMargin: '200px 0px' });

      document.querySelectorAll('[data-example]').forEach(el => observer.observe(el));

      // Auto-resize iframes
      window.addEventListener('message', (e) => {
        if (e.data?.type === 'iframe-resize') {
          const iframe = [...document.querySelectorAll('iframe')].find(f => f.contentWindow === e.source);
          if (iframe) iframe.style.height = (e.data.h + 16) + 'px';
        }
      });

      // --- Sidemenu active tracking ---
      const links = document.querySelectorAll('[data-guide-link]');
      const sections = [];
      links.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const section = document.getElementById(href.slice(1));
          if (section) sections.push({ link, section });
        }
      });
      if (!sections.length) return;
      let currentActive = null;
      const sectionObserver = new IntersectionObserver((entries) => {
        let bestEntry = null;
        for (const entry of entries) {
          if (entry.isIntersecting && (!bestEntry || entry.boundingClientRect.top < bestEntry.boundingClientRect.top)) bestEntry = entry;
        }
        if (bestEntry) {
          const match = sections.find(s => s.section === bestEntry.target);
          if (match && match.link !== currentActive) {
            if (currentActive) { currentActive.removeAttribute('aria-current'); currentActive.closest('.fr-sidemenu__item')?.classList.remove('fr-sidemenu__item--active'); }
            match.link.setAttribute('aria-current', 'true');
            match.link.closest('.fr-sidemenu__item')?.classList.add('fr-sidemenu__item--active');
            currentActive = match.link;
          }
        }
      }, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });
      sections.forEach(s => sectionObserver.observe(s.section));
      if (sections.length > 0) { sections[0].link.setAttribute('aria-current', 'true'); sections[0].link.closest('.fr-sidemenu__item')?.classList.add('fr-sidemenu__item--active'); currentActive = sections[0].link; }
    });
  </script>
</body>
</html>
