/**
 * Application state for Builder IA
 */

/** A data source object (from localStorage) */
export interface Source {
  id: string;
  name: string;
  type: 'api' | 'grist' | 'manual';
  url?: string;
  data?: Record<string, unknown>[];
  recordCount?: number;
}

/** Analyzed field metadata */
export interface Field {
  name: string;
  type: string;
  sample: unknown;
}

/** Chart configuration generated by the AI */
export interface ChartConfig {
  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar' | 'horizontalBar' | 'scatter' | 'gauge' | 'kpi' | 'map';
  labelField?: string;
  valueField: string;
  valueField2?: string;
  codeField?: string;
  aggregation?: 'sum' | 'avg' | 'count' | 'min' | 'max';
  limit?: number;
  sortOrder?: 'desc' | 'asc';
  title?: string;
  subtitle?: string;
  color?: string;
  color2?: string;
  variant?: 'info' | 'success' | 'warning' | 'error';
  unit?: string;
  palette?: string;
  where?: string;
  data2?: AggregatedResult[];
}

/** A single aggregated data result */
export interface AggregatedResult {
  label: string;
  value: number;
  code?: string | null;
}

/** Chat message */
export interface Message {
  role: 'user' | 'assistant';
  content: string;
}

/** Application state shape */
export interface AppState {
  source: Source | null;
  localData: Record<string, unknown>[] | null;
  fields: Field[];
  chartConfig: ChartConfig | null;
  chart: unknown | null;
  messages: Message[];
  isThinking: boolean;
}

/** Global application state singleton */
export const state: AppState = {
  source: null,
  localData: null,
  fields: [],
  chartConfig: null,
  chart: null,
  messages: [],
  isThinking: false,
};
