<!DOCTYPE html>
<html lang="fr" data-fr-theme>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tabular - API supportees - gouv-widgets</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css" integrity="sha384-VuzA/gYnk/ZqcT5a/ravR88otj71vNPl/h1JPrKoESV33DCX6SeXIxBcRr5qYPRj" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css" integrity="sha384-YR4AxNhFVy1qsQ0Hp7Rosg06e4sj2m9dLxiYZrtqJ0boIOiDbD8XkIsIPMMkf0VL" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" integrity="sha384-6FSSi597BTd6QcnsBNoLclRKxTOyyYqkaucRjFgCNr8wHVCp0COLClSPY4Vy/bjh" crossorigin="anonymous">
  <script type="module" src="/dist/gouv-widgets.esm.js"></script>
  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .capability-yes { color: var(--text-default-success); font-weight: bold; }
    .capability-no { color: var(--text-default-error); }
  </style>
</head>
<body>
  <app-header current-page="composants" base-path="../../"></app-header>

  <app-layout-demo
    title="Tabular (data.gouv.fr)"
    icon="ri-government-line"
    active-path="apis/tabular"
    base-path="../">
    <div slot="content">
        <p class="fr-text--lead">
          API <strong>Tabular</strong> de <a href="https://www.data.gouv.fr" target="_blank" rel="noopener">data.gouv.fr</a>.
          Donne acces aux ressources tabulaires (CSV, Excel) hebergees sur la plateforme nationale d'open data.
        </p>

        <div class="fr-callout fr-callout--green-emeraude">
          <h4 class="fr-callout__title">Agregation et group-by serveur</h4>
          <p class="fr-callout__text">
            Tabular supporte la <strong>pagination par page</strong> (500 pages de 50, soit 25 000 enregistrements),
            le <strong>tri serveur</strong>, et surtout le <strong>group-by et l'agregation cote serveur</strong>
            (<code>sum</code>, <code>avg</code>, <code>count</code>, <code>min</code>, <code>max</code>).
            La recherche full-text et les facettes restent cote client.
          </p>
        </div>

        <!-- Capacites serveur -->
        <section class="fr-mt-4w">
          <h2>Capacites serveur</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr>
                  <th>Capacite</th>
                  <th>Support</th>
                  <th>Detail</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Fetch serveur</td>
                  <td class="capability-yes">Oui</td>
                  <td>Recuperation paginee des donnees</td>
                </tr>
                <tr>
                  <td>Facettes serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Facettes calculees cote client (mode statique)</td>
                </tr>
                <tr>
                  <td>Recherche serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Recherche effectuee cote client</td>
                </tr>
                <tr>
                  <td>Group-by serveur</td>
                  <td class="capability-yes">Oui</td>
                  <td>Parametre <code>column__groupby</code></td>
                </tr>
                <tr>
                  <td>Tri serveur</td>
                  <td class="capability-yes">Oui</td>
                  <td>Parametre <code>column__sort=asc|desc</code></td>
                </tr>
                <tr>
                  <td>Agregation serveur</td>
                  <td class="capability-yes">Oui</td>
                  <td>Parametres <code>column__sum</code>, <code>__avg</code>, <code>__count</code>, <code>__min</code>, <code>__max</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Pagination -->
        <section class="fr-mt-4w">
          <h2>Pagination</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre</th><th>Valeur</th></tr>
              </thead>
              <tbody>
                <tr><td>Type</td><td><code>page</code> (par numero de page)</td></tr>
                <tr><td>Taille de page</td><td>50 enregistrements (maximum API)</td></tr>
                <tr><td>Pages max</td><td>500</td></tr>
                <tr><td>Enregistrements max</td><td>25 000</td></tr>
                <tr><td>Parametres URL</td><td><code>page</code>, <code>page_size</code></td></tr>
                <tr><td>Page suivante</td><td>Champ <code>next</code> dans la reponse</td></tr>
              </tbody>
            </table>
          </div>
          <div class="fr-highlight fr-mt-2w">
            <p>
              La pagination serveur est geree par <code>gouv-source</code> avec l'attribut <code>auto-pagination</code>.
              Les metadonnees serveur sont accessibles via <code>meta.page</code>, <code>meta.page_size</code>
              et <code>meta.total</code>.
            </p>
          </div>
        </section>

        <!-- Syntaxe de requete -->
        <section class="fr-mt-4w">
          <h2>Syntaxe de requete</h2>
          <p>
            Tabular utilise une syntaxe <strong>colon</strong> (deux-points) pour les filtres :
            <code>field:operator:value</code>.
          </p>

          <h3 class="fr-mt-2w">Operateurs disponibles</h3>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Operateur generique</th><th>Operateur Tabular</th><th>Description</th></tr>
              </thead>
              <tbody>
                <tr><td><code>eq</code></td><td><code>exact</code></td><td>Egal a</td></tr>
                <tr><td><code>neq</code></td><td><code>differs</code></td><td>Different de</td></tr>
                <tr><td><code>gt</code></td><td><code>strictly_greater</code></td><td>Strictement superieur</td></tr>
                <tr><td><code>gte</code></td><td><code>greater</code></td><td>Superieur ou egal</td></tr>
                <tr><td><code>lt</code></td><td><code>strictly_less</code></td><td>Strictement inferieur</td></tr>
                <tr><td><code>lte</code></td><td><code>less</code></td><td>Inferieur ou egal</td></tr>
                <tr><td><code>contains</code></td><td><code>contains</code></td><td>Contient la valeur</td></tr>
                <tr><td><code>notcontains</code></td><td><code>notcontains</code></td><td>Ne contient pas</td></tr>
                <tr><td><code>in</code></td><td><code>in</code></td><td>Dans la liste</td></tr>
                <tr><td><code>notin</code></td><td><code>notin</code></td><td>Pas dans la liste</td></tr>
                <tr><td><code>isnull</code></td><td><code>isnull</code></td><td>Est null</td></tr>
                <tr><td><code>isnotnull</code></td><td><code>isnotnull</code></td><td>N'est pas null</td></tr>
              </tbody>
            </table>
          </div>

          <h3 class="fr-mt-2w">Separateur WHERE</h3>
          <p>Les clauses WHERE multiples sont jointes par <code>, </code> (virgule + espace).</p>

          <h3 class="fr-mt-2w">Agregation serveur</h3>
          <p>
            L'API supporte l'agregation cote serveur via des parametres URL :
          </p>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre URL</th><th>Description</th><th>Attribut gouv-query</th></tr>
              </thead>
              <tbody>
                <tr><td><code>column__groupby</code></td><td>Grouper par cette colonne</td><td><code>group-by="column"</code></td></tr>
                <tr><td><code>column__sum</code></td><td>Somme</td><td><code>aggregate="column:sum"</code></td></tr>
                <tr><td><code>column__avg</code></td><td>Moyenne</td><td><code>aggregate="column:avg"</code></td></tr>
                <tr><td><code>column__count</code></td><td>Comptage</td><td><code>aggregate="column:count"</code></td></tr>
                <tr><td><code>column__min</code></td><td>Minimum</td><td><code>aggregate="column:min"</code></td></tr>
                <tr><td><code>column__max</code></td><td>Maximum</td><td><code>aggregate="column:max"</code></td></tr>
              </tbody>
            </table>
          </div>
          <div class="fr-highlight fr-mt-2w">
            <p>
              Les colonnes de resultat sont nommees <code>column__operator</code> (ex : <code>population__sum</code>).
              Les filtres sont appliques <strong>avant</strong> l'agregation.
            </p>
          </div>
        </section>

        <!-- Selection de colonnes -->
        <section class="fr-mt-4w">
          <h2>Selection de colonnes</h2>
          <p>
            L'API supporte la selection de colonnes specifiques via le parametre <code>columns</code> :
          </p>
          <pre><code>?columns=nom,prenom,commune</code></pre>
          <p class="fr-mt-1w">
            Cela reduit la taille de la reponse en ne retournant que les colonnes demandees.
          </p>
        </section>

        <!-- Facettes -->
        <section class="fr-mt-4w">
          <h2>Facettes</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre</th><th>Valeur</th></tr>
              </thead>
              <tbody>
                <tr><td>Mode par defaut</td><td><strong>static</strong> (client-side)</td></tr>
                <tr><td>Endpoint serveur</td><td>Non disponible</td></tr>
              </tbody>
            </table>
          </div>
          <p class="fr-mt-1w">
            Les facettes sont calculees sur les donnees deja recuperees cote client.
            Si le jeu de donnees est volumineux, pensez a utiliser <code>auto-pagination</code>
            pour charger plus de donnees avant le calcul des facettes.
          </p>
        </section>

        <!-- Authentification -->
        <section class="fr-mt-4w">
          <h2>Authentification</h2>
          <p>
            Type : <strong>aucune</strong>. L'API Tabular de data.gouv.fr est publique et ne necessite
            pas d'authentification.
          </p>
        </section>

        <!-- Structure de reponse -->
        <section class="fr-mt-4w">
          <h2>Structure de reponse</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre</th><th>Valeur</th></tr>
              </thead>
              <tbody>
                <tr><td>Chemin des donnees</td><td><code>data</code></td></tr>
                <tr><td>Chemin du total</td><td><code>meta.total</code></td></tr>
                <tr><td>Donnees imbriquees</td><td>Non (champs a plat)</td></tr>
                <tr><td>Necessite flatten</td><td>Non</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Detection automatique -->
        <section class="fr-mt-4w">
          <h2>Detection automatique</h2>
          <p>
            gouv-widgets detecte automatiquement une source Tabular si l'URL contient :
          </p>
          <ul>
            <li><code>tabular-api.data.gouv.fr/api/resources/{resourceId}</code></li>
          </ul>
          <p class="fr-mt-1w">
            Host connu : <code>tabular-api.data.gouv.fr</code> (proxy : <code>/tabular-proxy</code>).
          </p>
        </section>

        <!-- Exemple -->
        <section class="fr-mt-4w">
          <h2>Exemple d'utilisation</h2>

          <h3>Graphique avec agregation</h3>
          <pre><code>&lt;gouv-source
  id="src"
  api-type="tabular"
  resource="2876a346-d50c-4911-934e-19ee07b0e503"
  auto-pagination&gt;
&lt;/gouv-source&gt;

&lt;gouv-query
  source="src"
  group-by="region"
  aggregate="population:sum"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart
  source="src"
  type="bar"
  name-field="region"
  value-field="population"&gt;
&lt;/gouv-dsfr-chart&gt;</code></pre>

          <h3 class="fr-mt-2w">Datalist avec pagination serveur</h3>
          <pre><code>&lt;gouv-source
  id="src"
  api-type="tabular"
  resource="2876a346-d50c-4911-934e-19ee07b0e503"
  server-side&gt;
&lt;/gouv-source&gt;

&lt;gouv-datalist
  source="src"
  columns="nom,prenom,commune"
  page-size="20"&gt;
&lt;/gouv-datalist&gt;</code></pre>
        </section>
    </div>
  </app-layout-demo>

  <app-footer base-path="../../"></app-footer>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.module.min.js"></script>
</body>
</html>
