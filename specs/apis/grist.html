<!DOCTYPE html>
<html lang="fr" data-fr-theme>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grist - API supportees - gouv-widgets</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css" integrity="sha384-VuzA/gYnk/ZqcT5a/ravR88otj71vNPl/h1JPrKoESV33DCX6SeXIxBcRr5qYPRj" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css" integrity="sha384-YR4AxNhFVy1qsQ0Hp7Rosg06e4sj2m9dLxiYZrtqJ0boIOiDbD8XkIsIPMMkf0VL" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" integrity="sha384-6FSSi597BTd6QcnsBNoLclRKxTOyyYqkaucRjFgCNr8wHVCp0COLClSPY4Vy/bjh" crossorigin="anonymous">
  <script type="module" src="/dist/gouv-widgets.esm.js"></script>
  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .capability-yes { color: var(--text-default-success); font-weight: bold; }
    .capability-no { color: var(--text-default-error); }
  </style>
</head>
<body>
  <app-header current-page="composants" base-path="../../"></app-header>

  <app-layout-demo
    title="Grist"
    icon="ri-table-2"
    active-path="apis/grist"
    base-path="../">
    <div slot="content">
        <p class="fr-text--lead">
          API <strong>Grist</strong>, tableur collaboratif open source. Supporte
          <a href="https://grist.numerique.gouv.fr" target="_blank" rel="noopener">grist.numerique.gouv.fr</a>
          (instance souveraine) et <a href="https://docs.getgrist.com" target="_blank" rel="noopener">docs.getgrist.com</a>.
        </p>

        <div class="fr-callout fr-callout--orange-terre-battue">
          <h4 class="fr-callout__title">Tout cote client</h4>
          <p class="fr-callout__text">
            L'API Grist retourne toutes les donnees en une seule requete, sans pagination ni
            capacites serveur avancees. Les transformations (tri, agregation, facettes, recherche)
            sont effectuees <strong>cote client</strong> par <code>gouv-query</code>.
          </p>
        </div>

        <div class="fr-callout fr-callout--blue-france fr-mt-2w">
          <h4 class="fr-callout__title">Structure imbriquee</h4>
          <p class="fr-callout__text">
            Les enregistrements Grist sont structures en <code>records[].fields</code>.
            Il faut utiliser <code>&lt;gouv-normalize flatten="fields"&gt;</code> pour aplatir
            les champs et les rendre directement accessibles.
          </p>
        </div>

        <!-- Capacites serveur -->
        <section class="fr-mt-4w">
          <h2>Capacites serveur</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr>
                  <th>Capacite</th>
                  <th>Support</th>
                  <th>Detail</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Fetch serveur</td>
                  <td class="capability-yes">Oui</td>
                  <td>Toutes les donnees en une requete</td>
                </tr>
                <tr>
                  <td>Facettes serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Facettes calculees cote client</td>
                </tr>
                <tr>
                  <td>Recherche serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Recherche effectuee cote client</td>
                </tr>
                <tr>
                  <td>Group-by serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Group-by effectue cote client par <code>gouv-query</code></td>
                </tr>
                <tr>
                  <td>Tri serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Tri effectue cote client par <code>gouv-query</code></td>
                </tr>
                <tr>
                  <td>Agregation serveur</td>
                  <td class="capability-no">Non</td>
                  <td>Agregation effectuee cote client par <code>gouv-query</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Pagination -->
        <section class="fr-mt-4w">
          <h2>Pagination</h2>
          <p>
            <strong>Aucune pagination.</strong> L'API Grist retourne toutes les donnees de la table en une seule reponse.
            Cela convient aux tables de taille moderee (quelques milliers de lignes).
          </p>
        </section>

        <!-- Structure de reponse -->
        <section class="fr-mt-4w">
          <h2>Structure de reponse</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre</th><th>Valeur</th></tr>
              </thead>
              <tbody>
                <tr><td>Chemin des donnees</td><td><code>records</code></td></tr>
                <tr><td>Chemin du total</td><td>Non disponible</td></tr>
                <tr><td>Donnees imbriquees</td><td>Oui (<code>fields</code>)</td></tr>
                <tr><td>Necessite flatten</td><td><strong>Oui</strong> (<code>gouv-normalize flatten="fields"</code>)</td></tr>
              </tbody>
            </table>
          </div>

          <h3 class="fr-mt-2w">Avant et apres flatten</h3>
          <div class="fr-grid-row fr-grid-row--gutters fr-mt-1w">
            <div class="fr-col-12 fr-col-md-6">
              <h4>Reponse brute</h4>
              <pre><code>{
  "records": [
    {
      "id": 1,
      "fields": {
        "nom": "Paris",
        "population": 2165423
      }
    }
  ]
}</code></pre>
            </div>
            <div class="fr-col-12 fr-col-md-6">
              <h4>Apres flatten</h4>
              <pre><code>[
  {
    "id": 1,
    "nom": "Paris",
    "population": 2165423
  }
]</code></pre>
            </div>
          </div>
        </section>

        <!-- Syntaxe de requete -->
        <section class="fr-mt-4w">
          <h2>Syntaxe de requete</h2>
          <p>
            L'API Grist ne supporte pas de syntaxe de requete cote serveur.
            Toutes les transformations sont effectuees <strong>cote client</strong> par <code>gouv-query</code>,
            qui utilise la syntaxe colon generique (<code>field:operator:value</code>).
          </p>
          <p class="fr-mt-1w">
            Agregation : <strong>client uniquement</strong>. Pas de syntaxe serveur disponible.
          </p>
        </section>

        <!-- Facettes -->
        <section class="fr-mt-4w">
          <h2>Facettes</h2>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Parametre</th><th>Valeur</th></tr>
              </thead>
              <tbody>
                <tr><td>Mode par defaut</td><td><strong>client</strong></td></tr>
                <tr><td>Endpoint serveur</td><td>Non disponible</td></tr>
              </tbody>
            </table>
          </div>
          <p class="fr-mt-1w">
            Les facettes sont calculees sur les donnees normalisees (apres flatten).
          </p>
        </section>

        <!-- Authentification -->
        <section class="fr-mt-4w">
          <h2>Authentification</h2>
          <p>
            Type : <strong>Bearer token</strong>.<br>
            Les documents Grist prives necessitent un jeton d'API passe dans le header
            <code>Authorization: Bearer {token}</code>. En production, le proxy nginx gere
            l'authentification.
          </p>
        </section>

        <!-- Detection automatique -->
        <section class="fr-mt-4w">
          <h2>Detection automatique</h2>
          <p>
            gouv-widgets detecte automatiquement une source Grist si l'URL contient :
          </p>
          <ul>
            <li><code>/api/docs/{documentId}/tables/{tableId}</code></li>
          </ul>

          <h3 class="fr-mt-2w">Hosts connus et proxy</h3>
          <div class="fr-table">
            <table>
              <thead>
                <tr><th>Hostname</th><th>Endpoint proxy</th></tr>
              </thead>
              <tbody>
                <tr><td><code>grist.numerique.gouv.fr</code></td><td><code>/grist-gouv-proxy</code></td></tr>
                <tr><td><code>docs.getgrist.com</code></td><td><code>/grist-proxy</code></td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Exemple -->
        <section class="fr-mt-4w">
          <h2>Exemple d'utilisation</h2>

          <h3>Graphique avec normalize flatten</h3>
          <pre><code>&lt;gouv-source
  id="src"
  api-type="grist"
  document-id="mXPMwAHoRQbP"
  table-id="Table1"&gt;
&lt;/gouv-source&gt;

&lt;gouv-normalize
  source="src"
  id="flat"
  flatten="fields"&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-query
  source="flat"
  group-by="region"
  aggregate="population:sum"&gt;
&lt;/gouv-query&gt;

&lt;gouv-dsfr-chart
  source="flat"
  type="bar"
  name-field="region"
  value-field="population"&gt;
&lt;/gouv-dsfr-chart&gt;</code></pre>

          <h3 class="fr-mt-2w">Datalist simple</h3>
          <pre><code>&lt;gouv-source
  id="src"
  api-type="grist"
  document-id="mXPMwAHoRQbP"
  table-id="Table1"&gt;
&lt;/gouv-source&gt;

&lt;gouv-normalize
  source="src"
  id="flat"
  flatten="fields"&gt;
&lt;/gouv-normalize&gt;

&lt;gouv-datalist
  source="flat"
  columns="nom,prenom,commune"
  page-size="20"&gt;
&lt;/gouv-datalist&gt;</code></pre>
        </section>
    </div>
  </app-layout-demo>

  <app-footer base-path="../../"></app-footer>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.module.min.js"></script>
</body>
</html>
