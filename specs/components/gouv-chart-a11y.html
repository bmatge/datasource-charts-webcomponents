<!DOCTYPE html>
<html lang="fr" data-fr-theme>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gouv-chart-a11y - Composants - gouv-widgets</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css" integrity="sha384-VuzA/gYnk/ZqcT5a/ravR88otj71vNPl/h1JPrKoESV33DCX6SeXIxBcRr5qYPRj" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css" integrity="sha384-YR4AxNhFVy1qsQ0Hp7Rosg06e4sj2m9dLxiYZrtqJ0boIOiDbD8XkIsIPMMkf0VL" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" integrity="sha384-6FSSi597BTd6QcnsBNoLclRKxTOyyYqkaucRjFgCNr8wHVCp0COLClSPY4Vy/bjh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.css">
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.js"></script>
  <script type="module" src="/dist/gouv-widgets.esm.js"></script>
  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
  </style>
</head>
<body>
  <!-- Sources de donnees -->
  <gouv-source id="sites" url="/mock-api/data.json" transform="sites"></gouv-source>

  <!-- Header -->
  <app-header current-page="composants" base-path="../../"></app-header>

  <!-- Layout documentation avec sidemenu -->
  <app-layout-demo
    title="gouv-chart-a11y"
    icon="ri-accessibility-line"
    active-path="components/gouv-chart-a11y"
    base-path="../">
    <div slot="content">
        <p class="fr-text--lead">
          Companion d'accessibilite unifie pour les visualisations. Offre trois
          alternatives activables independamment : <strong>tableau de donnees</strong>,
          <strong>telechargement CSV</strong> et <strong>description textuelle</strong>.
          Le contenu est replie dans un accordeon DSFR par defaut.
        </p>

        <div class="fr-callout fr-callout--green-emeraude fr-mb-4w">
          <h3 class="fr-callout__title">
            <span class="ri-accessibility-line fr-mr-1w" aria-hidden="true"></span>
            Accessibilite
          </h3>
          <p class="fr-callout__text">
            Les graphiques (canvas, SVG) sont difficilement accessibles aux lecteurs d'ecran.
            <code>gouv-chart-a11y</code> offre trois alternatives complementaires :
            un tableau HTML, un telechargement CSV et une description textuelle.
            Via l'attribut <code>for</code>, il injecte un skip link dans le graphique,
            pose <code>aria-describedby</code> et <code>aria-details</code> pour
            creer un lien semantique complet.
          </p>
        </div>

        <h2>Attributs</h2>
        <table class="attr-table">
          <thead><tr><th>Attribut</th><th>Type</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>source</code></td><td>String</td><td>ID du <code>&lt;gouv-source&gt;</code> ou <code>&lt;gouv-query&gt;</code> (requis)</td></tr>
            <tr><td><code>for</code></td><td>String</td><td>ID de l'element cible pour skip link + ARIA automatique</td></tr>
            <tr><td><code>table</code></td><td>Boolean</td><td>Active l'affichage du tableau de donnees</td></tr>
            <tr><td><code>download</code></td><td>Boolean</td><td>Active le bouton de telechargement CSV</td></tr>
            <tr><td><code>filename</code></td><td>String</td><td>Nom du fichier CSV (defaut : <code>donnees.csv</code>)</td></tr>
            <tr><td><code>description</code></td><td>String</td><td>Description textuelle du graphique</td></tr>
            <tr><td><code>label-field</code></td><td>String</td><td>Colonne pour les labels du tableau (optionnel)</td></tr>
            <tr><td><code>value-field</code></td><td>String</td><td>Colonne(s) pour les valeurs (separees par virgules, optionnel)</td></tr>
            <tr><td><code>label</code></td><td>String</td><td>Libelle personnalise de la section accessible</td></tr>
            <tr><td><code>no-auto-aria</code></td><td>Boolean</td><td>Desactive ARIA automatique et skip link</td></tr>
          </tbody>
        </table>
        <p class="fr-text--sm fr-mt-1w">Si ni <code>table</code>, ni <code>download</code>, ni <code>description</code> ne sont definis, les trois sont actives par defaut.</p>

        <h2 class="fr-mt-4w">Fonctionnement ARIA</h2>
        <ol>
          <li>Le composant genere automatiquement un <code>id</code> s'il n'en a pas</li>
          <li>Un <strong>skip link</strong> est injecte dans le graphique cible (visible au focus clavier)</li>
          <li><code>aria-describedby</code> pointe vers un resume concis dans le composant</li>
          <li><code>aria-details</code> pointe vers le tableau de donnees (si <code>table</code> est active)</li>
          <li>A la deconnexion, tout est nettoye automatiquement</li>
        </ol>

        <h2 class="fr-mt-4w">Exemples</h2>

        <section class="demo-section">
          <h3>1. Tableau + telechargement CSV</h3>
          <gouv-query id="data-chart" source="sites"
            group-by="statut" aggregate="statut:count:total">
          </gouv-query>
          <gouv-dsfr-chart id="demo-chart" source="data-chart" type="bar"
            label-field="statut" value-field="total" titre="Sites par statut">
          </gouv-dsfr-chart>
          <gouv-chart-a11y for="demo-chart" source="data-chart" table download></gouv-chart-a11y>
          <div class="code-block"><pre>&lt;gouv-dsfr-chart id="mon-graph" source="data" type="bar"
  label-field="statut" value-field="total"&gt;
&lt;/gouv-dsfr-chart&gt;
&lt;gouv-chart-a11y for="mon-graph" source="data" table download&gt;&lt;/gouv-chart-a11y&gt;</pre></div>
        </section>

        <section class="demo-section">
          <h3>2. Avec description textuelle</h3>
          <gouv-chart-a11y for="demo-chart" source="data-chart"
            table download
            description="Ce graphique montre la repartition des sites par statut. Les sites actifs sont les plus nombreux.">
          </gouv-chart-a11y>
          <div class="code-block"><pre>&lt;gouv-chart-a11y for="mon-graph" source="data"
  table download
  description="Ce graphique montre la repartition des sites par statut."&gt;
&lt;/gouv-chart-a11y&gt;</pre></div>
        </section>

        <section class="demo-section">
          <h3>3. Mode manuel (no-auto-aria)</h3>
          <p>Si vous gerez manuellement les attributs ARIA :</p>
          <div class="code-block"><pre>&lt;gouv-chart-a11y source="data"
  no-auto-aria table download&gt;
&lt;/gouv-chart-a11y&gt;</pre></div>
        </section>
    </div>
  </app-layout-demo>

  <app-footer base-path="../../"></app-footer>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.module.min.js"></script>
</body>
</html>
